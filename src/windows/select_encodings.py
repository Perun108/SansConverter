"""Select Encodings dialog window generated by QtDesigner with edits"""

from PyQt5.QtWidgets import (
    QCheckBox,
    QApplication,
    QDialog,
    QGridLayout,
    QVBoxLayout,
    QDialogButtonBox,
)
from PyQt5.QtCore import QMetaObject, QCoreApplication, Qt

from encoding_mappings import Encodings
from windows.select_encodings_warning import WarningDialog


class UiSelectEncodingsDialog(QDialog):
    """Enable/Disable encodings GUI"""

    def __init__(self, parent):
        super().__init__(parent)
        self.setupUi(self)
        self.parent_dialog = parent

    def setupUi(self, Dialog):
        Dialog.setObjectName("Dialog")
        Dialog.resize(400, 300)
        Dialog.setWindowTitle(
            QCoreApplication.translate("Dialog", "Select encodings", None)
        )
        self.mainLayout = QVBoxLayout(Dialog)
        self.gridLayout = QGridLayout()
        self.mainLayout.addLayout(self.gridLayout)

        self.buttonBox = QDialogButtonBox(Dialog)
        self.buttonBox.setObjectName("buttonBox")
        self.buttonBox.setOrientation(Qt.Horizontal)
        self.buttonBox.setStandardButtons(QDialogButtonBox.Cancel | QDialogButtonBox.Ok)
        self.mainLayout.addWidget(self.buttonBox)

        self._add_checkboxes(Dialog)

        self.buttonBox.accepted.connect(self.check_selected_encodings)
        self.buttonBox.rejected.connect(self.reject)

        QMetaObject.connectSlotsByName(Dialog)

    def _add_checkboxes(self, dialog):
        """Add checkBoxes for all encodings for users to select from"""

        self.checkboxes = [QCheckBox(dialog) for _ in Encodings]
        for idx, checkbox in enumerate(self.checkboxes):
            checkbox.setObjectName(f"checkBox_{idx}")
            checkbox.setText(
                QCoreApplication.translate("Dialog", list(Encodings)[idx].value, None)
            )
            # We won't have more than 8 encodings, so 4 is good for the foreseen future
            self.gridLayout.addWidget(checkbox, idx % 4, idx // 4, 1, 1)

    def get_selected_encodings(self):
        """Returns a list of selected encodings"""

        return [cb.text() for cb in self.checkboxes if cb.isChecked()]

    def check_selected_encodings(self):
        selected_encodings = self.get_selected_encodings()
        if not selected_encodings:
            warning_dialog = WarningDialog(self)
            # Accepted here means 'Use All Available Encodings'
            if warning_dialog.exec_() == QDialog.Accepted:
                self.accept()
                self.selected_encodings = self.parent_dialog.all_encodings
            else:
                return
        else:
            self.accept()
